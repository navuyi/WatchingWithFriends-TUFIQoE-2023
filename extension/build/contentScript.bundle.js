(()=>{"use strict";var e=function(){function e(e){var t=this;this.prefix=e,this.original_logger=console.log,this.custom_logger=function(e){var n,r,o,i,a,l,c,u,s="".concat(t.prefix," | ").concat((n=new Date,r=n.getFullYear(),o=(n.getMonth()+1).toString().padStart(2,"0"),i=n.getDate().toString().padStart(2,"0"),a=n.getHours().toString().padStart(2,"0"),l=n.getMinutes().toString().padStart(2,"0"),c=n.getSeconds().toString().padStart(2,"0"),u=n.getMilliseconds().toString().padStart(3,"0"),"".concat(r,"-").concat(o,"-").concat(i,"T").concat(a,":").concat(l,":").concat(c,".").concat(u))," |");t.original_logger(s,e)}}return e.prototype.log=function(e){this.custom_logger(e)},e}(),t=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))},n=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},r=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))},o=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},i=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))},a=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},l=function(e){return i(void 0,void 0,void 0,(function(){return a(this,(function(t){switch(t.label){case 0:return[4,chrome.storage.local.get([e])];case 1:return[2,t.sent()[e]]}}))}))},c="video_index",u="subject_id",s=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))},f=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}},h=function i(){var a=this;this.init=function(){return s(a,void 0,void 0,(function(){var e,t;return f(this,(function(n){switch(n.label){case 0:return e=this,[4,l(c)];case 1:return e.video_index=n.sent(),t=i,[4,this.get_nerd_stats_elements()];case 2:return t.nerd_stats_elements=n.sent(),this.start_manager_cycle(),[2]}}))}))},this.get_nerd_stats_elements=function(){return s(a,void 0,void 0,(function(){var e=this;return f(this,(function(i){return[2,new Promise((function(i){var a=setInterval((function(){return s(e,void 0,void 0,(function(){var e,l,c,u;return f(this,(function(s){switch(s.label){case 0:return e=document.getElementsByClassName("html5-video-info-panel").item(0),l=document.getElementsByClassName("html5-video-info-panel-content").item(0),null==e||null==l?[3,1]:(clearInterval(a),this.logger.log("Nerd Stats already enabled. Resolving..."),i({video_info_panel:e,video_info_panel_content:l}),[3,4]);case 1:return this.logger.log("Nerd Stats not available. Invoking..."),[4,t(void 0,void 0,void 0,(function(){return n(this,(function(e){return[2,new Promise((function(e){var t=setInterval((function(){var n=document.getElementById("movie_player");n?(console.log("Found movie_player element. Resolving..."),clearInterval(t),e(n)):console.log("movie_element not found. Retrying...")}),10)}))]}))}))];case 2:return function(e){var t=e,n=t.ownerDocument.createEvent("MouseEvents");n.initMouseEvent("contextmenu",!0,!0,t.ownerDocument.defaultView,1,0,0,0,0,!1,!1,!1,!1,2,null),console.log("Opening player context menu"),t.dispatchEvent(n)}(s.sent()),[4,r(void 0,void 0,void 0,(function(){return o(this,(function(e){return[2,new Promise((function(e){var t=setInterval((function(){var n=document.getElementsByClassName("ytp-popup ytp-contextmenu").item(0);if(null!=n){var r=n.children.item(0);if(null!=r){var o=r.children.item(0);if(null!=o){var i=o.children,a=i.item(i.length-1);null!=a&&(clearInterval(t),console.log("Enabling nerd statistics window"),a.click(),e())}}}}),10)}))]}))}))];case 3:s.sent(),c=document.getElementsByClassName("html5-video-info-panel").item(0),u=document.getElementsByClassName("html5-video-info-panel-content").item(0),null!=c&&null!=u&&(this.logger.log("Found elements. Resolving..."),i({video_info_panel:c,video_info_panel_content:u})),s.label=4;case 4:return[2]}}))}))}),500)}))]}))}))},this.is_video_index_matching=function(){return s(a,void 0,void 0,(function(){var e;return f(this,(function(t){switch(t.label){case 0:return[4,l(c)];case 1:return e=t.sent(),this.logger.log("My video_index is ".concat(this.video_index,". Global is ").concat(e)),e!==this.video_index?(this.logger.log("Video index mismatch!"),[2,!1]):[2,!0]}}))}))},this.clear_interval=function(){a.logger.log("Clearing interval..."),a.interval&&clearInterval(a.interval)},this.start_manager_cycle=function(){a.interval=setInterval((function(){return s(a,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this.is_video_index_matching()];case 1:return!e.sent()&&this.interval?(this.logger.log("Clearing interval..."),clearInterval(this.interval),[2]):(window.location.href.includes("https://www.youtube.com/watch?v=")?(this.logger.log("Doing the logic here!!! - Analyzing nerd stats using external class!"),this.logger.log(i.nerd_stats_elements)):(this.logger.log("Outside of video player. Clearing interval..."),this.interval&&clearInterval(this.interval)),[2])}}))}))}),1e3)},this.logger=new e("[NerdStatsManager]")},v=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(i){return function(l){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,l])}}};(function(e,t,n,r){new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function l(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,l)}c((r=r.apply(e,t||[])).next())}))})(void 0,void 0,void 0,(function(){return v(this,(function(e){switch(e.label){case 0:return[4,chrome.storage.local.get([u])];case 1:return e.sent()[u],[4,(new h).init()];case 2:return e.sent(),[2]}}))}))})();